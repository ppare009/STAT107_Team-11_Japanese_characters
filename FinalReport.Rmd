---
title: "STAT 107 Final Project—Final Report"
output:
  html_document: default
  pdf_document: default
date: "`r Sys.Date()`"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Abstract
In Japanese, there are three main writing systems: Hiragana, Katakana, and Kanji. Hiragana and Katakana are both phonetic-based (i.e., every character represents a sound), while Kanji is pictorial (i.e., each character represents a concept). While each writing system represents the same set of sounds, for individuals learning how to read in Japanese, it is often confusing to know which writing system to learn first. Should an individual's goal in learning Japanese be to read novels, it is interesting to know what writing system one would encounter the most—as to most efficiently tailor their learning experience to meet their goals. 

Thus, we plan to sample 20 books from the online sources Gutenberg and Aozora to analyze the overall distribution of Hiragana, Katakana, and Kanji within them. 

## Introduction
The purpose of this analysis is to examine the distribution of the three main Japanese writing systems: Hiragana, Katakana, and Kanji in the novels we obtained from the online libraries Gutenberg and Aozora. Specifically we aim to determine whether the frequency of each writing system differs between texts originally written in Japanese(found in Aozora), and works translates into Japanese(found in Gutenberg). 

  With this analysis, we are trying to answer the question that is: How do the distributions of Hiragana, Katakana, and Kanji differ between original Japanese novels and translated Japanese novels? By addressing this question, we provide insights for Japanese language learners who want to mainly focus their studies on the writing system most relevant in the type of novels they intend to read.
  
  This analysis may benefit translators, linguists, and language learners. As it offers factual data on writing system usage in Japanese literature. In terms of methodology, we are performing a comparative analysis bt sampling and classifying characters in each test according to their writing system. This allows us to classify and compare patterns in the writing system, providing a clear image of how different types of text utilize Hiragana, Katakana, Kanji.


## Part 1: Data 

### Part 1.1: Japanese Literature

For this project, we will observe several novels from both the (Gutenberg)[www.gutenberg.org] website and the (Aozora)[https://www.aozora.gr.jp/.] website. Gutenberg is an English-based online library consisting of several eBooks in the public domain. Likewise, Aozora is a Japanese-based online library serving the same purpose. 

We chose these sites due to the types of literature within them. From what we observed, the Japanese selection on Gutenberg mostly consists of works translated TO Japanese, while Aozora mostly consists of works written ORIGINALLY in Japanese. Thus, collecting a sample from both of the sites can provide insights as to how the distribution of each of the three writings systems differ between originally-Japanese works and works translated to Japanese. 

We randomly selected 10 novels from both websites. However, this was done differently for both websites. For the noveles on the Gutenberg website, a simple random selection of all the Japanese language books on the site was conducted.
However, this was not necessairly possible on Aozora—as the only way to see a masterlist of all of the novels is through sorting by authors. Thus, we ran a SRS on the authors that are not under copyright, and randomly select one of their novels (if they have multiple novels listed under their authorship).

The novels we ended up selecting  (and their file names) are the following: 

From Gutenberg:

| File Name | Novel Name | Author | Novel Source |
| --- | --- | --- | --- |
| "pg36358.txt" | お目出たき人 | Saneatsu Mushanokoji | https://www.gutenberg.org/ebooks/31757 |
| "pg37605.txt" | 羹 | Jun'ichiro Tanizaki | https://www.gutenberg.org/ebooks/36459 |
| "pg34084.txt" | 幽霊書店 | Christopher Morley | https://www.gutenberg.org/ebooks/41325 |
| "pg37626.txt" | 下宿人 | Marie Belloc Lowndes | https://www.gutenberg.org/ebooks/32978 |
| "pg31757.txt" | 友情 | Saneatsu Mushanokoji | https://www.gutenberg.org/ebooks/33307 |
| "pg36459.txt" | 刺靑 | Jun'ichiro Tanizaki | https://www.gutenberg.org/ebooks/31617 |
| "pg41325.txt" | 火星の記憶 | Raymond F. Jones | https://www.gutenberg.org/ebooks/36358 |
| "pg32978.txt" | 惡魔 | Jun'ichiro Tanizaki | https://www.gutenberg.org/ebooks/37605 |
| "pg33307.txt" | 法螺男爵旅土産 | Kuni Sasaki | https://www.gutenberg.org/ebooks/34084 | 
| "pg31617.txt" | 續惡魔 | Jun'ichiro Tanizaki | https://www.gutenberg.org/ebooks/37626 |

---

From Aozora:

| File Name | Novel Name | Author | Novel Source |
| --- | --- | --- | --- |
| "onnano_kao.txt" | 人間の本性 | Shin, Katakami | https://www.aozora.gr.jp/cards/000492/card42252.html |
| "ningenno_honsho.txt" | 化学改革の大略 | Shimizu, Usaburo | https://www.aozora.gr.jp/cards/001508/card51403.html |
| "kagaku_kaikakuno_tairyaku.txt" | 枯尾花 | Sekine, Mokuan | https://www.aozora.gr.jp/cards/001358/card49253.html |
| "kareobana.txt" | 将棋の話 | Shigeru, Tonomura | https://www.aozora.gr.jp/cards/001499/card52185.html |
| "shogino_hanashi.txt" | 色盲検査表の話 | Shinobu, Ishihara | https://www.aozora.gr.jp/cards/001742/card55751.html |
| "shikimo_kensahyo.txt" | 父八雲を語る | Iwao, Inagaki | https://www.aozora.gr.jp/cards/001961/card58832.html |
| "chichi_yakumoo_kataru.txt" | おくのほそ道 | Matsuo, Basho | https://www.aozora.gr.jp/cards/002240/card61619.html |
| "02okunohosomichi.txt" | 青バスの女 | Tatsuno, Kyushi | https://www.aozora.gr.jp/cards/001782/card56514.html |
| "ao_basuno_onna.txt" | 古事記物語 | Otomo, Yasumaro | https://www.aozora.gr.jp/cards/000107/card1530.html |
| "kojiki_monogatari.txt" | 女の顔 | Kuroda, Seiki | https://www.aozora.gr.jp/cards/000257/card1425.html |

---

### Part 1.2: Dataframe

After cleaning the data and processing it (see "Part 2: Data Cleaning/Processing"), we end up with a single dataframe called `jp_novels_df`—of which contains the following variables:

1. `site`: factor. A variable describing which of the two sites (Gutenberg or Aozora) the novel came from.

2. `body_chars_total`: numerical. Total number of characters in the actual text of the literature (excluding the characters found in the header/footer).

3. `kanji`: numerical. Total number of characters from the body that are in Kanji.

4. `hiragana`: numerical. Total number of characters from the body that are in Hiragana.

5. `katakana`: numerical. Total number of characters from the body that are in Katakana.

6. `japanese_total`: numerical. Total number of characters from the body that are in Japanese (`kanji` + `hiragana` + `katakana`).

7. `non_japanese`: numerical. Total number of characters from the body that are NOT in Japanese.

8. `removed_chars_header_footer`: numerical. Number of characters removed from the novel file as part of the header/footer.

9. `removed_ascii_english`: numerical. Number of Latin-script characters (ie, characters in English) that was removed from the novel file. 

## Part 2: Data Cleaning/Processing:

The data cleaning/processing portion of this project was done on a separate file called `01_build_jp_novels.Rmd`. This file must be ran first in order to produce the `jp_novels_df` that will be used for the remainder of this analysis. 

Should the dataframe be created correctly, it should look like the following:

```{r}
library(ggplot2)

aozora <- read.csv("Data Processing/aozora_summary.csv")
gutenberg <- read.csv("Data Processing/gutenberg_summary.csv")
jp_novels_df <- rbind(aozora, gutenberg)
  
head(jp_novels_df, 10)
```

With this clean dataset, one is ready to perform analysis. 

## Part 3: Preliminary Analysis:

After cleaning the data and organizing it into a single dataframe, it is possible to perform a preliminary analysis of the variables.

Firstly, since they are the basis of this project, it is imperative to observe the distributions of Hiragana, Katakana, and Kanji within the sample data:

```{r, echo=FALSE}
# [NOTE]: Figure 1

par(mfrow = c(1, 3))

boxplot(jp_novels_df$hiragana, main = "Hiragana Distribution", 
        ylim = c(0, 150000), col = rgb(1, 0, 0, 0.25))
boxplot(jp_novels_df$katakana, main = "Katakana Distribution",  sub = "Figure 1",
        ylim = c(0, 150000), col = rgb(0, 1, 0, 0.25))
boxplot(jp_novels_df$kanji, main = "Kanji Distribution", 
        ylim = c(0, 150000), col = rgb(0, 0, 1, 0.25))
```

Based on these charts, it is apparent that the distributions for each of the three writing systems are quite skewed right. That is, there are many novels with a smaller counts of Hiragana, Katakana, and Kanji than there are larger counts of each writing system. Even so, it seems that there is a smaller spread of Katakana than there is of the other two writing systems. 

However, it is possible that these results could be skewed by higher total character counts within given novels. To alleviate part of this, one can find the percentage of each novel's Japanese characters that belong to each writing system:

```{r, echo=FALSE}
# [NOTE]: Figure 2

# [STEP 1]: Create a new column in `jp_novels_df` that represents the proportion of each novel's Japanese characters that are part of a given writing system.
jp_novels_df$hiragana_proportion <- jp_novels_df$hiragana / jp_novels_df$japanese_total
jp_novels_df$katakana_proportion <- jp_novels_df$katakana / jp_novels_df$japanese_total
jp_novels_df$kanji_proportion <- jp_novels_df$kanji / jp_novels_df$japanese_total

# [STEP 2]: Display 
par(mfrow = c(1, 3))

boxplot(jp_novels_df$hiragana_proportion, 
        main = "Hiragana Proportion Distribution",
        cex.main = 0.9,
        ylim = c(0, 1), col = rgb(1, 0, 0, 0.25))
boxplot(jp_novels_df$katakana_proportion, 
        main = "Katakana Proportion Distribution",  sub = "Figure 2",
        cex.main = 0.9,
        ylim = c(0, 1), col = rgb(0, 1, 0, 0.25))
boxplot(jp_novels_df$kanji_proportion, 
        main = "Kanji Proportion Distribution", 
        cex.main = 0.9,
        ylim = c(0, 1), col = rgb(0, 0, 1, 0.25))

```

Now that these values are standardized, one can see that the proportion of Hiragana seems fairly normal compared to the other two systems. In addition, for the novels seen, the proportion of the novels that are written in Katakana is far smaller than the proportions of the other two systems—reaching a mean of only 10% of the novels. 

Additionally, it is interesting to note the difference in the distributions of Hiragana, Katakana, and Kanji between both the Gutenberg and Aozora sites:

```{r, echo=FALSE}
# [NOTE]: Figures 3 through 5

ggplot(jp_novels_df, aes(x = hiragana_proportion)) + 
  geom_boxplot(aes(col = site)) + xlim(0, 0.8) + 
  ggtitle("Distribution of Hiragana in Japanese Novels, Split by Host Website",
          subtitle = "Figure 3") + 
  xlab("Proportion of Novel")

ggplot(jp_novels_df, aes(x = katakana_proportion)) + 
  geom_boxplot(aes(col = site)) + xlim(0, 0.8) +
  ggtitle("Distribution of Katakana in Japanese Novels, Split by Host Website",
          subtitle = "Figure 4") +
  xlab("Proportion of Novel")

ggplot(jp_novels_df, aes(x = kanji_proportion)) + 
  geom_boxplot(aes(col = site)) + xlim(0, 0.8) +
  ggtitle("Distribition of Kanji in Japanese Novels, Split by Host Website",
          subtitle = "Figure 5") +
  xlab("Proportion of Novel")

```

These graphs seem to suggest a very clear difference in the distributions of the three systems between Aozora and Gutenberg—indicating merit in analyzing the differences between these two websites' novels further.

With this preliminary analysis complete, it is now possible to move to more complicated analysis. 

## Part 4: Analysis:

The goal of this project is to determine if there are any significant differences in the distributions of Hiragana, Katakana, and Kanji within Japanese works. In order to definitively determine this, one can run a collection of two-sample t-tests between each of the three writing systems (i.e., comparing Hiragana and Katakana, Katakana and Kanji, and Hiragana and Kanji).

In addition, to determine if there is a significant difference between the distribution of the writing systems in originally-Japanese works and works translated to Japanese, one can run a two-sample t-test for each writing system on the novels that are from Aozora and the novels that are from Gutenberg.

Via these tests, it is possible to answer the questions that were proposed at the beginning of this report. 

### Part 4.1: Two-Sample T-Test for Difference in Writing System Distribution Means:

According to [The University of Austin, Texas](https://sites.utexas.edu/sos/guided/inferential/numeric/onecat/2-groups/independent/two-sample-t/), in order to run a Two-Sample T-Test, there are some assumptions to be made:

1. Both datasets are normally distributed.

2. Each each observation in both datasets are independent.

3. The population variances of both datasets are equal.

Thus, in order to analyze whether or not there is a difference in the mean number of characters of these three writing systems within all of the gathered novels, it is important to verify these conditions hold.

Since each datapoint that we are using come from unique novels, and these novels were randomly selected from the greater selection of novels present in both Aozora and Gutenberg, it is safe to say that the observations in our compared datsets are independent.

However, according to the distributions seen in Figure 1, it is evident that the distributions of Hiragana, Katakana, and Kanji characters are extremely right-skewed—voiding the normality assumption required for the t-Test. In order to remedy this, we apply a log transformation to the measurements in question. The resulting distributions are the following:

```{r, echo=FALSE}
# [NOTE]: Figure 6

log_hiragana <- log(jp_novels_df$hiragana)
log_katakana <- log(jp_novels_df$katakana)
log_kanji <- log(jp_novels_df$kanji)


par(mfrow = c(1, 3))

boxplot(log_hiragana, 
        main = "Log-Transformed Hiragana Distribution", 
         cex.main = 0.75,
        ylim = c(0, 15), col = rgb(1, 0, 0, 0.25))
boxplot(log_katakana, 
        main = "Log-Transformed Katakana Distribution",  sub = "Figure 6",
         cex.main = 0.75,
        ylim = c(0, 15), col = rgb(0, 1, 0, 0.25))
boxplot(log_kanji, 
        main = "Log-Transformed Kanji Distribution", 
        cex.main = 0.75,
        ylim = c(0, 15), col = rgb(0, 0, 1, 0.25))
```

After performing this transformation, the data seems to be far closer to the normal distribution than before. Thus, it is possible for the normalcy condition to be met, provide that these log-transformed values of Hiragana, Katakana, and Kanji counts are used for analysis instead of the original values.

Finally, one should check the variances of the log-transformed data. When calculated using the base-R function `var()`, the following results arose: 

- Hiragana: 3.143388 characters²

- Katakana: 3.148605 characters²

- Kanji: 2.71181 characters²

In this instance, the variances of the log-transformed Hiragana counts and log-transformed Katakana counts are extremely similar (differint by just over 0.005 characters²), while the variance of the log-transformed Kanji count is lower than both of them. This means that the variances of the transformed Hiragana and Katakana counts could be similar, while the variances of any combination with Kanji will not be similar.


In summary, using the log-transformation, it is reasonable to assume independence and normality (assumptions 1 and 2). However, it cannot be definitively assumed that the variances between each writing system are equal. 

To be safe, instead of the common Student's t-Test, one can use the Welch t-Test. This version of the t-Test still assumes normality and independence, but does NOT require equal variances between the two distributions in question. This version of the t-Test is perfect for our needs. 

With this preliminary screening complete, it is time to perform the Two-Sample T-Tests for Difference in Means. 

For each of these tests, the null hypothesis is that $\mu_1 = \mu_2$, and the alternate hypothesis is that $\mu_1 \neq \mu_2$. The results of these t-tests will be compared to an alpha level of $\alpha = 0.05$. 

To complete this step, we used the `t.test()` function in R—of which calculates The values of $\mu_1$ and $\mu_2$, as well as the results of these tests, are the following:

| Test # | Hiragana | Katakana | Kanji | 95% Confidence Interval | p-value | 
| ----- | -------- | -------- | --------- | -------------------- | ----- |
| 1 | $\mu_1$ | $\mu_2$ | N/A | [0.5098914, 2.7808238] | 0.005655 |
| 2 | $\mu_1$ | N/A | $\mu_2$ | [-0.5614726,  1.6296081] | 0.3299 |
| 3 | N/A | $\mu_1$ | $\mu_2$ | [-2.20732265, -0.01525716] | 0.04705 |

Based on these results, it seems that there is a statistically significant difference in the means between the distributions of Katakana and the remaining two writing systems. However, interestingly, there is no evidence to suggest that the the distributions of Hiragana and Kanji are different for Japanese novels obtained on Gutenberg and Aozora.

The positive values in the 95% Confidence Interval for Test 1 seems to suggest that the mean number of Hiragana characters is larger than the mean number of Katakana characters. Likewise, the negative values in the 95% Confidence Interval for Test 3 suggest a higher mean number of Kanji than Katakana characters. In hindsight, this result makes sense. According to [Tae Kim's online Japanese Learning resource "A Guide to Learn Japanese Grammar"](https://guidetojapanese.org/learn/category/grammar-guide/the-writing-system/), despite being a phonetic writing system like Hiragana, Katakana's main purpose is to translate western words into Japanese. This contrasts the wider usages of Hiragana and Kanji in Japanese—as both systems are essential for written grammar. Thus, since Katakana is used less often compared to both Hiragana and Kanji, it makes sense as to why the mean for Katakana is statistically lower than that of both Hiragana and Kanji. 


### Part 4.2: Two-Sample T-Test for Difference in Hosting Webstite Distribution Means:

[tbd]

## Part 5: Conclusion:

[insert here]

## Part 6: Team Member Contributions:
1. Pankshi Parekar: Created/Organized the GitHub repository. Created/Organized the Final Report. Ran the Simple Random Selections for choosing the novels for analysis, and prepared the `data` folder in the GitHub repository accordingly.  Wrote the Abstract, as well as parts 1, 3, and 4 in the report. 

2. Isabella Perez: Wrote the Introduction section of the report. 

3. Ulices Ramirez Lopez:  Built an R Markdown workflow to automatically clean the Japanese text files from Aozora and Gutenberg. The main goal was to remove unnecessary parts like headers, footers, and any non-Japanese or English characters. Did this by reading each .txt file, converting the text to UTF-8, cutting out lines before and after certain markers (like ----- and 底本：), and deleting inline Aozora markup such as ［＃...］, 《...》, and ｜. After cleaning, the script counted only Japanese characters (kanji, hiragana, and katakana) to measure how much of the text remained. Finally, it saved two CSV summaries, one for Aozora and one for Gutenberg — showing the cleaned results for each file.
